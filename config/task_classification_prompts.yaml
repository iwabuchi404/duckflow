# TaskProfile分類用プロンプトテンプレート
# LLMベース分類システム用の Few-Shot Learning プロンプト

task_classification:
  # 基本分類プロンプト
  base_template: |
    あなたはTaskProfile分類の専門家です。ユーザーの要求を分析し、
    最適なTaskProfileを特定してください。

    【TaskProfile種別】
    1. INFORMATION_REQUEST: 情報の参照・確認・表示・読み取り
    2. ANALYSIS_REQUEST: 分析・評価・調査・比較・レビュー
    3. CREATION_REQUEST: 新規作成・実装・構築・開発
    4. MODIFICATION_REQUEST: 修正・変更・改善・更新・編集
    5. SEARCH_REQUEST: 検索・探索・発見・特定
    6. GUIDANCE_REQUEST: 手順・方法・操作の指導・実行方法

    【重要な判定基準】
    - "見て"、"教えて"、"内容" → INFORMATION_REQUEST
    - "レビュー"、"評価"、"分析"、"比較" → ANALYSIS_REQUEST  
    - "作成"、"実装"、"書いて"、"構築" → CREATION_REQUEST
    - "修正"、"変更"、"改善"、"直して" → MODIFICATION_REQUEST
    - "探して"、"検索"、"見つけて"、"特定" → SEARCH_REQUEST
    - "実行"、"使い方"、"方法"、"手順" → GUIDANCE_REQUEST

  # Few-Shot学習例
  few_shot_examples:
    - input: "README.mdの内容を教えて"
      output: |
        {
          "profile_type": "INFORMATION_REQUEST",
          "confidence": 0.95,
          "reasoning": "ファイル内容の確認・表示を求めている",
          "detected_intent": "情報参照",
          "complexity_assessment": "SIMPLE",
          "suggested_approach": "ファイル読み取り"
        }

    - input: "README.mdをレビューして品質を評価して"
      output: |
        {
          "profile_type": "ANALYSIS_REQUEST",
          "confidence": 0.9,
          "reasoning": "レビューと評価は分析的作業",
          "detected_intent": "品質分析",
          "complexity_assessment": "MODERATE",
          "suggested_approach": "ファイル分析と評価"
        }

    - input: "README.mdを改善して読みやすくして"
      output: |
        {
          "profile_type": "MODIFICATION_REQUEST",
          "confidence": 0.9,
          "reasoning": "既存ファイルの改善・修正を求めている",
          "detected_intent": "ファイル修正",
          "complexity_assessment": "MODERATE",
          "suggested_approach": "ファイル編集"
        }

    - input: "main.pyとconfig.pyを比較して違いを教えて"
      output: |
        {
          "profile_type": "ANALYSIS_REQUEST",
          "confidence": 0.85,
          "reasoning": "2ファイルの比較分析を求めている",
          "detected_intent": "比較分析",
          "complexity_assessment": "MODERATE",
          "suggested_approach": "ファイル比較分析"
        }

    - input: "Pythonでログ機能を実装して"
      output: |
        {
          "profile_type": "CREATION_REQUEST",
          "confidence": 0.95,
          "reasoning": "新しい機能の作成を求めている",
          "detected_intent": "機能実装",
          "complexity_assessment": "COMPLEX",
          "suggested_approach": "新機能実装"
        }

    - input: "バグを探して修正して"
      output: |
        {
          "profile_type": "MODIFICATION_REQUEST",
          "confidence": 0.85,
          "reasoning": "バグ発見は検索要素もあるが、修正が主目的",
          "detected_intent": "バグ修正",
          "complexity_assessment": "COMPLEX",
          "suggested_approach": "デバッグと修正"
        }

    - input: "プロジェクトの構造を教えて"
      output: |
        {
          "profile_type": "INFORMATION_REQUEST",
          "confidence": 0.9,
          "reasoning": "プロジェクト情報の確認を求めている",
          "detected_intent": "構造確認",
          "complexity_assessment": "SIMPLE",
          "suggested_approach": "プロジェクト探索"
        }

    - input: "テストを実行する方法を教えて"
      output: |
        {
          "profile_type": "GUIDANCE_REQUEST",
          "confidence": 0.9,
          "reasoning": "実行方法・手順の説明を求めている",
          "detected_intent": "操作指導",
          "complexity_assessment": "SIMPLE",
          "suggested_approach": "手順説明"
        }

    - input: "エラーログを分析して原因を特定して"
      output: |
        {
          "profile_type": "ANALYSIS_REQUEST",
          "confidence": 0.9,
          "reasoning": "ログ分析と原因特定は分析的作業",
          "detected_intent": "問題分析",
          "complexity_assessment": "MODERATE",
          "suggested_approach": "ログ解析"
        }

    - input: "使われていない関数を見つけて"
      output: |
        {
          "profile_type": "SEARCH_REQUEST",
          "confidence": 0.9,
          "reasoning": "特定条件の要素を探索することが目的",
          "detected_intent": "コード探索",
          "complexity_assessment": "MODERATE",
          "suggested_approach": "コード検索"
        }

  # 出力フォーマット指示
  format_instructions: |
    【分析結果をJSON形式で出力】
    {
      "profile_type": "選択したTaskProfile（上記6種類のいずれか）",
      "confidence": 0.0から1.0の信頼度,
      "reasoning": "分類した理由の詳細説明",
      "detected_intent": "検出した具体的な意図",
      "complexity_assessment": "SIMPLE/MODERATE/COMPLEX",
      "suggested_approach": "推奨する実行アプローチ"
    }

# コンテキスト拡張版プロンプト
contextual_classification:
  template_with_context: |
    {base_template}

    【追加コンテキスト情報】
    - 検出されたファイル: {detected_files}
    - 直前の対話: {conversation_history}
    - プロジェクト種別: {project_type}
    - ワークスペース状況: {workspace_info}

    この文脈情報を考慮して、より正確な分類を行ってください。

    【ユーザーの要求】
    {user_request}

    {format_instructions}

# ガードレール設定
guardrails:
  # 明確な動詞パターン
  explicit_verb_patterns:
    creation_verbs: ["作成", "作って", "実装", "開発", "構築", "書いて", "生成", "追加"]
    modification_verbs: ["修正", "変更", "直して", "改修", "更新", "編集", "改善"]
    analysis_verbs: ["分析", "レビュー", "評価", "調査", "比較", "診断"]
    search_verbs: ["探して", "検索", "見つけて", "特定", "発見"]
    info_verbs: ["教えて", "見て", "表示", "確認", "内容", "読み"]
    guidance_verbs: ["実行", "使い方", "方法", "手順", "やり方"]

  # 複合パターンの優先度
  compound_patterns:
    - pattern: "比較.*違い"
      override_to: "ANALYSIS_REQUEST"
      reason: "比較と差分検出は分析作業"
    
    - pattern: "レビュー.*改善"
      override_to: "ANALYSIS_REQUEST"  # レビューを優先
      reason: "レビューが主目的の場合は分析作業"

    - pattern: "見るだけ|表示だけ|確認だけ"
      override_to: "INFORMATION_REQUEST"
      reason: "読み取り専用指定"

  # 信頼度調整ファクター
  confidence_factors:
    clarity_thresholds:
      very_short: 10  # 文字数10未満は低信頼度
      detailed: 200   # 文字数200以上は高信頼度
    
    keyword_bonuses:
      specific_verbs: 0.1      # 具体的動詞のボーナス
      file_mentions: 0.05      # ファイル言及のボーナス
      context_richness: 0.1    # コンテキスト豊富さボーナス
    
    penalties:
      ambiguous_terms: -0.1    # 曖昧な表現のペナルティ
      contradictory: -0.2      # 矛盾する要素のペナルティ

# システム設定
system_config:
  # === 分類システム統合管理 ===
  classification_mode: "auto_select"  # "rule_only", "hybrid_experimental", "hybrid_production", "auto_select"
  
  # LLM分類システムの有効化フラグ
  use_llm_classification: true
  
  # フォールバック設定
  llm_confidence_threshold: 0.6   # この値未満はルールベースフォールバック
  enable_guardrails: true         # ガードレールの有効化
  fallback_to_rules: true         # エラー時ルールベースフォールバック
  
  # パフォーマンス設定
  llm_timeout_seconds: 5          # LLM応答タイムアウト
  cache_classification_results: false  # 分類結果キャッシュ（将来実装）
  
  # デバッグ設定
  log_classification_details: true     # 分類詳細をログ出力
  save_classification_examples: false  # 分類例を保存（学習用）
  log_experimental_comparisons: true   # 実験モード比較結果のログ出力
  
  # === 段階的移行設定 ===
  migration:
    # 移行フェーズ管理
    current_phase: "experimental"  # "disabled", "experimental", "gradual", "full"
    
    # 自動選択閾値
    auto_select_complexity_threshold: 0.7
    
    # 実験モード設定
    experimental_sampling_rate: 1.0  # 実験対象とする要求の割合（0.0-1.0）
    
    # A/Bテスト設定（将来実装）
    enable_ab_testing: false
    ab_test_split_ratio: 0.5  # A/Bテストの分割比率