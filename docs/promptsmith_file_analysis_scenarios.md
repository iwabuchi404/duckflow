# PromptSmith ファイル内容解析シナリオ設計書

**作成日**: 2025年8月9日  
**バージョン**: 1.0  
**目的**: PromptSmithによるファイル解析能力向上のためのテストシナリオ

## 1. 概要

このドキュメントでは、DuckflowのPromptSmithシステムにおいて、ファイル内容解析タスクの品質向上を目的としたテストシナリオを定義します。

### 1.1. 対象となる解析タスク

- **コード構造解析**: クラス・関数・変数の抽出
- **バグ・問題点検出**: 潜在的な問題の特定
- **改善提案**: リファクタリング・最適化の提案
- **依存関係分析**: インポート・モジュール関係の把握
- **仕様理解**: ファイルの目的・機能の説明
- **コードレビュー**: コード品質・慣例の評価

## 2. シナリオ分類

### 2.1. 基本シナリオ（レベル1）
**目標**: 基本的なファイル読み取りと単純な解析

#### シナリオ1-1: 単純なPythonファイル解析
- **入力**: 関数が1つだけの簡単なPythonファイル
- **期待される解析**: 関数名、引数、戻り値、処理内容の説明

#### シナリオ1-2: JSONファイル構造解析
- **入力**: 設定ファイル形式のJSON
- **期待される解析**: 設定項目の説明、型情報、用途の推測

#### シナリオ1-3: Markdownドキュメント要約
- **入力**: READMEファイル
- **期待される解析**: 主要セクション、プロジェクトの目的、使用方法の要約

### 2.2. 中級シナリオ（レベル2）
**目標**: 複雑な構造とロジックの理解

#### シナリオ2-1: クラス構造の詳細解析
- **入力**: 複数のクラスとメソッドを含むPythonファイル
- **期待される解析**: 継承関係、メソッドの関連性、責務分担の評価

#### シナリオ2-2: 問題のあるコードの検出
- **入力**: 意図的にバグを含むコード
- **期待される解析**: バグの特定、原因の説明、修正案の提示

#### シナリオ2-3: パフォーマンス問題の特定
- **入力**: 非効率なアルゴリズムを含むコード
- **期待される解析**: ボトルネックの特定、最適化案の提示

### 2.3. 高級シナリオ（レベル3）
**目標**: 曖昧な要求とコンテキスト理解

#### シナリオ3-1: 不完全な情報での解析
- **ユーザー要求**: 「このファイルの問題を見つけて」（具体的な指定なし）
- **期待される対応**: 適切な質問で要求を明確化、包括的な分析

#### シナリオ3-2: 複数ファイル間の関連性分析
- **入力**: 相互に関連する複数ファイル
- **期待される解析**: ファイル間の依存関係、設計パターンの特定

#### シナリオ3-3: レガシーコードの現代化提案
- **入力**: 古いコーディング慣例で書かれたファイル
- **期待される解析**: 現代的なベストプラクティスに基づく改善提案

## 3. 評価指標

### 3.1. 精度指標
- **解析正確性**: 検出した要素（クラス、関数等）の正答率
- **問題検出率**: 実在する問題の発見率
- **誤検出率**: 存在しない問題の誤報告率

### 3.2. 完全性指標
- **カバレッジ**: ファイル内の重要要素の網羅率
- **深度**: 分析の詳細度レベル
- **関連性**: 提案内容の実用性

### 3.3. ユーザビリティ指標
- **説明の明確性**: 技術的内容の理解しやすさ
- **実行可能性**: 提案の具体性と実現可能性
- **質問の適切性**: 不明点を明確化するための質問品質

## 4. 挑戦的要素

### 4.1. エッジケース
- **大容量ファイル**: 数千行のコードファイル
- **多言語混在**: Python + JavaScript + HTMLの組み合わせ
- **暗号化・難読化**: 意図的に読みにくくしたコード

### 4.2. 曖昧性対応
- **不明確な要求**: 「よくして」「改善して」等の抽象的指示
- **矛盾する情報**: ファイル名と内容が一致しない場合
- **文脈不足**: 単体では理解困難なファイル

### 4.3. 専門領域
- **機械学習コード**: TensorFlow/PyTorchコード
- **データベーススキーマ**: SQL DDL文
- **設定ファイル**: YAML、TOML、環境変数

## 5. 成功基準

### 5.1. レベル1（基本）
- 90%以上の基本要素（関数名、クラス名）を正確に識別
- ファイルの主要目的を1文で説明可能
- 明らかなシンタックスエラーを検出

### 5.2. レベル2（中級）
- 80%以上の論理的問題を検出
- 適切な改善提案を3つ以上提示
- コードの品質を5段階で評価

### 5.3. レベル3（高級）
- 曖昧な要求に対して適切な質問を返す
- 文脈を考慮した設計パターンを特定
- 段階的な改善ロードマップを提示

## 6. 実装計画

1. **テストファイル作成**: 各シナリオに対応するサンプルファイル
2. **TesterAIシナリオ実装**: 自動テストケース生成
3. **評価システム**: 解析結果の自動評価機構
4. **継続改善**: フィードバックループによるプロンプト最適化

この設計書に基づいて、次のステップでは具体的なテストファイルとシナリオ実装を行います。